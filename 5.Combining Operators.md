# 5.Combining Operators

## Prepending

ì›ë˜ ê²Œì‹œìì˜ ì•ì— ê°’ì„ ì¶”ê°€í•˜ëŠ”ë° ì‚¬ìš©í•˜ëŠ” ì—°ì‚°ìì…ë‹ˆë‹¤..

### prepend(Output...)

ì›ë˜ ê²Œì‹œìì™€ ë™ì¼í•œ ì¶œë ¥ íƒ€ì…ì´ë©´ ì›í•˜ëŠ” ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
example(of: "prepend(Output...)") {
    let publisher = [3, 4].publisher
    publisher
        .prepend(1, 2)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
}
// print
â€”â€”â€” Example of: prepend(Output...) â€”â€”â€”
1
2
3
4
```

ì›ë˜ê²Œì‹œìì˜ ê°’ 3, 4 ì•ì— 1, 2ê°€ ë¨¼ì € ì˜¤ëŠ”ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ

</br>

### prepend(Sequence)

ìœ„ì—ì„œë³¸ ì—°ì‚°ìì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤.

ì°¨ì´ì ìœ¼ë¡œëŠ” ì‹œí€€ìŠ¤ë¥¼ ì¤€ìˆ˜í•˜ëŠ” ê°ì²´ë¥¼ ì…ë ¥ê°’ìœ¼ë¡œ ë„˜ê¸°ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì˜ˆë¥¼ë“¤ì–´, ë°°ì—´ì´ë‚˜ Setì„ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift
example(of: "prepend(Sequence)") {
    let publisher = [5, 6, 7].publisher
    publisher
        .prepend([3, 4])
        .prepend(Set(1...2))
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
}
// print
â€”â€”â€” Example of: prepend(Sequence) â€”â€”â€”
2
1
3
4
5
6
7
```

ìœ„ì˜ê²½ìš° Setì„ ë„£ì—‡ê¸° ë–„ë¬¸ì— ìˆœì„œê°€ ë³´ì¥ë˜ì§€ì•ŠìŠµë‹ˆë‹¤.
ì¦‰, 1,2 í˜¹ì€ 2,1 ìˆœì„œê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</br>

### prepend(Publisher)

ë‹¤ë¥¸ ê²Œì‹œìë¥¼ ì›ë˜ ê²Œì‹œìì˜ ì•ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift
example(of: "prepend(Publisher)") {
    let publisher1 = [3, 4].publisher
    let publisher2 = [1, 2].publisher
    
    publisher1
        .prepend(publisher2)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
}
// print
â€”â€”â€” Example of: prepend(Publisher) â€”â€”â€”
1
2
3
4
```

ğŸ“Œ publisher1ì€ publisher2ê°€ **.finished ì™„ë£Œì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•œ í›„ì— ë°©ì¶œ**ë©ë‹ˆë‹¤.



``` swift
example(of: "prepend(Publisher) #2") {
    let publisher1 = [3, 4].publisher
    let publisher2 = PassthroughSubject<Int, Never>()
    publisher1
        .prepend(publisher2)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
    publisher2.send(1)
    publisher2.send(2)
}
// print
â€”â€”â€” Example of: prepend(Publisher) #2 â€”â€”â€”
1
2
```

`publisher2.send(completion: .finished)` ë¥¼ í•´ì£¼ë©´

publisher2ë°©ì¶œì´ ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì•Œê³  publisher1ì´ ë°©ì¶œí•˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤.

</br>

## Appending

ê²Œì‹œìê°€ ë‚´ë³´ë‚¸ ê°’ì„ ë‹¤ë¥¸ ê°’ê³¼ ì—°ê²°í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ì•ì„œ ë°°ìš´ prependì™€ ìœ ì‚¬í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤.

### append(Output)

ì›ë˜ ê²Œì‹œìê°€ `finished` ì´ë²¤íŠ¸ë¥¼ ì™„ë£Œí•œ í›„ ë’¤ì— í•­ëª©ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

``` swift
example(of: "append(Output...)") {
    let publisher = [1].publisher
    publisher
        .append(2, 3)
        .append(4)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
}
// print
â€”â€”â€” Example of: append(Output...) â€”â€”â€”
1
2
3
4
```

ì»´ë°”ì¸ì´ ì´ì „ ê²Œì‹œìê°€ ëª¨ë“  ê°’ì„ ë‚´ë³´ëƒˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë–„ë¬¸ì— ì—…ìŠ¤íŠ¸ë¦¼ì´ ì™„ë£Œë˜ê±°ë‚˜ ì¶”ê°€ë˜ì§€ì•Šì•„ì•¼í•©ë‹ˆë‹¤.



``` swift
example(of: "append(Output...) #2") {
    let publisher = PassthroughSubject<Int, Never>()
    publisher
        .append(3, 4)
        .append(5)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
    publisher.send(1)
    publisher.send(2)
}
// print
â€”â€”â€” Example of: append(Output...) #2 â€”â€”â€”
1
2
```

ê²Œì‹œìê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì‘ë™í•  ìˆ˜ ì—†ê¸°ë•Œë¬¸ì— íš¨ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.

`.finished` ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•˜ë©´

``` swift
publisher.send(completion: .finished)
â€”â€”â€” Example of: append(Output...) #2 â€”â€”â€”
1
2
3
4 
5
```

</br>

### append(Sequence)

ì›ë˜ ê²Œì‹œìì˜ ë°©ì¶œì´ ì™„ë£Œëœ ì´í›„ ì‹œí€€ìŠ¤ë¥¼ ì¤€ìˆ˜í•˜ëŠ” ê°ì²´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

``` swift

example(of: "append(Sequence)") {
    let publisher = [1, 2, 3].publisher
    publisher
        .append([4, 5])
        .append(Set([6, 7]))
        .append(stride(from: 8, to: 11, by: 2))
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
}
// print
â€”â€”â€” Example of: append(Sequence) â€”â€”â€”
1
2
3
4
5
6
7
8
10
```

</br>

### append(Publisher)

ì›ë˜ê²Œì‹œì ë’¤ë¡œ ë‹¤ë¥¸ê²Œì‹œìë¥¼ ë¶™ì…ë‹ˆë‹¤.

``` swift
example(of: "append(Publisher)") {
    let publisher1 = [1, 2].publisher
    let publisher2 = [3, 4].publisher
    publisher1
        .append(publisher2)
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
}
// print
â€”â€”â€” Example of: append(Publisher) â€”â€”â€”
1
2
3
4
```

</br>

## Advanced combining

### switchToLatest

í˜„ì¬ ë³´ë¥˜ì¤‘ì¸ ê²Œì‹œì êµ¬ë…ì„ ì·¨ì†Œí•˜ê³  ìµœì‹  êµ¬ë…ìœ¼ë¡œ ì „í™˜ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/35462671/168974602-00949b6b-3392-4106-a8df-06d049f2775d.png)

ìŠ¤íŠ¸ë¦¼ì„ í‰íƒ„í•˜ê²Œ ë§Œë“¤ì–´ì„œ í•˜ë‚˜ì˜ ìŠ¤íŠ¸ë¦¼ì—ì„œ ë‚˜ì˜¤ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œí•©ë‹ˆë‹¤.

ìƒˆê²Œì‹œìê°€ ë„ì°©í•˜ë©´ ë‚´ë¶€ ê²Œì‹œìë¥¼ ì „í™˜í•˜ì§€ë§Œ ë‹¤ìš´ ìŠ¤íŠ¸ë¦¼ êµ¬ë…ìì— ëŒ€í•´ì„œëŠ” ì™¸ë¶€ê²Œì‹œìë¥¼ ì¼ì •í•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤.

ì—…ìŠ¤íŠ¸ë¦¼ ê²Œì‹œìë¡œ ë¶€í„° ìƒˆ ê²Œì‹œìë¥¼ ë°›ìœ¼ë©´ ì´ì „ êµ¬ë…ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì´ì „ ê²Œì‹œìê°€ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ê²Œì‹œìë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ê²Œì‹œìë¥¼ ìì£¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë“± ë¶ˆí•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

(ì˜ˆì‹œ) 0.2ì´ˆë§ˆë‹¤ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ í†µì‹ ì„ í•˜ëŠ” ë¡œì§ì´ìˆë‹¤ë©´, ì›ë˜ê°™ì€ê²½ìš°ëŠ” 0.2ì´ˆë§ˆë‹¤ í†µì‹ ì„í•˜ì§€ë§Œ switchToLatestë¥¼ í†µí•´ì„œ ê²°ê³¼ê°€ ë‚˜ì˜¤ê¸°ì „ì— ê°’ì´ ë“¤ì–´ì™”ë‹¤ë©´ ì´ì „ êµ¬ë…ì„ ì·¨ì†Œí•˜ê³  ë§ˆì§€ë§‰(ìµœê·¼) ê°’ì— ëŒ€í•œ í†µì‹ ë§Œ ì´ë¤„ì§€ë©° ë¶ˆí•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift
example(of: "switchToLatest") {
    
    let publisher1 = PassthroughSubject<Int, Never>()
    let publisher2 = PassthroughSubject<Int, Never>()
    let publisher3 = PassthroughSubject<Int, Never>()
    
    let publishers = PassthroughSubject<PassthroughSubject<Int,
                                                           Never>, Never>()
    
    publishers
        .switchToLatest() // ê²Œì‹œìë¥¼ ë³´ë‚¼ë•Œë§ˆë‹¤ ìƒˆ ê²Œì‹œìë¡œ ì „í™˜í•¨
        .sink(
            receiveCompletion: { _ in print("Completed!") },
            receiveValue: { print($0) }
        )
        .store(in: &subscriptions)
    
    publishers.send(publisher1)
    publisher1.send(1)
    publisher1.send(2)
    // publisher1 êµ¬ë…ì´ ì·¨ì†Œë˜ê³  publisher2ê°€ êµ¬ë…ë¨
    publishers.send(publisher2)
    publisher1.send(3)
    publisher2.send(4)
    publisher2.send(5)
    
    publishers.send(publisher3)
    publisher2.send(6)
    publisher3.send(7)
    publisher3.send(8)
    publisher3.send(9)
    
    publisher3.send(completion: .finished)
    publishers.send(completion: .finished)
}
// print
â€”â€”â€” Example of: switchToLatest â€”â€”â€”
1
2
4
5
7
8
9
```

í˜„ì¬ ê²Œì‹œìì™€ publisher3ì— ì™„ë£Œì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ë©´ ëª¨ë“ êµ¬ë…ì´ ì™„ë£Œë©ë‹ˆë‹¤.

``` swift
let url = URL(string: "https://source.unsplash.com/random")!
func getImage() -> AnyPublisher<UIImage?, Never> {
    URLSession.shared
        .dataTaskPublisher(for: url)
        .map { data, _ in UIImage(data: data) }
        .print("image")
        .replaceError(with: nil)
        .eraseToAnyPublisher()
}

let taps = PassthroughSubject<Void, Never>()
taps
    .map { _ in getImage() }
    .switchToLatest()
    .sink(receiveValue: { _ in })
    .store(in: &subscriptions)

taps.send()
DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
    taps.send()
}
DispatchQueue.main.asyncAfter(deadline: .now() + 3.1) {
    taps.send()
}

// print
image: receive subscription: (DataTaskPublisher)
image: request unlimited
image: receive value: (Optional(<UIImage:0x600003610fc0 anonymous {1080, 711} renderingMode=automatic>))
image: receive finished
image: receive subscription: (DataTaskPublisher) // êµ¬ë…
image: request unlimited
image: receive cancel // 0.1í›„ì— ë°”ë¡œ ë˜ êµ¬ë…ì´ìƒê²¨ì„œ ì´ì „ ê²Œì‹œì ì·¨ì†Œ
image: receive subscription: (DataTaskPublisher) // ìƒˆ ê²Œì‹œì êµ¬ë…
image: request unlimited
image: receive value: (Optional(<UIImage:0x60000361c7e0 anonymous {1080, 974} renderingMode=automatic>))
image: receive finished

```

íƒ­ ì´ë²¤íŠ¸ê°€ 3ë²ˆë°œìƒí•˜ê³ 

í†µì‹ ì´ ì™„ë£Œë˜ê¸°ì „ íƒ­ì´ ë°œìƒí•˜ë©´ ì´ì „ í†µì‹ ì„ ì·¨ì†Œí•˜ê³  ìƒˆë¡œìš´í†µì‹ ì„ ì‹œì‘í•©ë‹ˆë‹¤.

</br>

### merge(with: )

ë™ì¼í•œ íƒ€ì…ì˜ ì—¬ëŸ¬ ê²Œì‹œìì˜ ë°©ì¶œì„ í•˜ë‚˜ë¡œ ë¼ì›Œ ë„£ìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/35462671/168988186-dcf044bd-a35d-41fd-9ebc-676dc66fa75a.png)

``` swift

example(of: "merge(with:)") {
    let publisher1 = PassthroughSubject<Int, Never>()
    let publisher2 = PassthroughSubject<Int, Never>()
    publisher1
        .merge(with: publisher2)
        .sink(
            receiveCompletion: { _ in print("Completed") },
            receiveValue: { print($0) }
        )
        .store(in: &subscriptions)

    publisher1.send(1)
    publisher1.send(2)
    publisher2.send(3)
    publisher1.send(4)
    publisher2.send(5)
    
    publisher1.send(completion: .finished)
    publisher2.send(completion: .finished)
}
// print
â€”â€”â€” Example of: merge(with:) â€”â€”â€”
1
2
3
4
5
Completed
```

ëª¨ë“  ê²Œì‹œìê°€ finishedë˜ì•¼ completedë©ë‹ˆë‹¤.

</br>

### combineLatest

ë‹¤ì–‘í•œ íƒ€ì…ì˜ ê²Œì‹œìë¥¼ ê²°í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìµœì´ˆë¡œ ê°’ì„ ë°©ì¶œí•˜ë ¤ë©´ ëª¨ë“  ê²Œì‹œìì—ì„œ í•˜ë‚˜ì´ìƒ ê°’ì„ ë°©ì¶œí•´ì•¼í•©ë‹ˆë‹¤.

ìµœì†Œ í•˜ë‚˜ì”© ë°©ì¶œí–ˆë‹¤ë©´ ê° ìŠ¤íŠ¸ë¦¼ì—ì„œ ìµœê·¼ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

ê·¸ ì´í›„ì—ëŠ” ë°©ì¶œí•  ë•Œë§ˆë‹¤ ëª¨ë“  ìŠ¤íŠ¸ë¦¼ì˜ ìµœê·¼ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/35462671/168989099-6ff72d30-f0a9-48c0-bb21-e16603ee9367.png)

``` swift

example(of: "combineLatest") {
    let publisher1 = PassthroughSubject<Int, Never>()
    let publisher2 = PassthroughSubject<String, Never>()
    publisher1
        .combineLatest(publisher2)
        .sink(
            receiveCompletion: { _ in print("Completed") },
            receiveValue: { print("P1: \($0), P2: \($1)") }
        )
        .store(in: &subscriptions)

    publisher1.send(1)
    publisher1.send(2)
    publisher2.send("a")
    publisher2.send("b")
    publisher1.send(3)
    publisher2.send("c")

    publisher1.send(completion: .finished)
    publisher2.send(completion: .finished)
}
// print
â€”â€”â€” Example of: combineLatest â€”â€”â€”
P1: 2, P2: a
P1: 2, P2: b
P1: 3, P2: b
P1: 3, P2: c
Completed
```

</br>

### zip

ëª¨ë“  ê²Œì‹œìê°€ ë°©ì¶œí•œ ê°’ì˜ ì¸ë±ìŠ¤ê°€ ê°™ì€ ê°’ì„ íŠœí”Œë¡œ ë°©ì¶œí•©ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/35462671/168991155-15fa1d8c-20e6-48d4-a62c-05fae64e66c7.png)

``` swift

example(of: "zip") {
    let publisher1 = PassthroughSubject<Int, Never>()
    let publisher2 = PassthroughSubject<String, Never>()
    
    publisher1
        .zip(publisher2)
        .sink(
            receiveCompletion: { _ in print("Completed") },
            receiveValue: { print("P1: \($0), P2: \($1)") }
        )
        .store(in: &subscriptions)
    
    publisher1.send(1)
    publisher1.send(2)
    publisher2.send("a")
    publisher2.send("b")
    publisher1.send(3)
    publisher2.send("c")
    publisher2.send("d")
    
    publisher1.send(completion: .finished)
    publisher2.send(completion: .finished)
}
// print
â€”â€”â€” Example of: zip â€”â€”â€”
P1: 1, P2: a
P1: 2, P2: b
P1: 3, P2: c
Completed
```

ê° ë°©ì¶œëœ ê°’ì´ ë‹¤ë¥¸ ê²Œì‹œìê°€ ê°™ì€ ì¸ë±ìŠ¤ì˜ ê°’ì„ ë°©ì¶œí•  ë•Œ ê¹Œì§€ **ëŒ€ê¸°**í•©ë‹ˆë‹¤.

