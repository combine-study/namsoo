# Publishers & Subscribers

## Hello Publisher

Publisher í”„ë¡œí† ì½œì€ Combineì˜ í•µì‹¬ì…ë‹ˆë‹¤.

ì´ í”„ë¡œí† ì½œì€ í•˜ë‚˜ ì´ìƒì˜ êµ¬ë…ìì—ê²Œ ì‹œê°„ì— ë”°ë¼ ê°’ì„ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ìœ í˜•ì— ëŒ€í•œ ìš”êµ¬ì‚¬í•­ì„ ì •ì˜í•©ë‹ˆë‹¤.

ì¦‰, publisherì€ ê´€ì‹¬ìˆëŠ” ê°’ì„ í¬í•¨í•  ìˆ˜ ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ publishe(ê²Œì‹œ)í•˜ê±°ë‚˜ emit(ë°©ì¶œ)í•©ë‹ˆë‹¤.

publisherì„ êµ¬ë…í•˜ëŠ” ë°©ë²•ì€ Notification Centerì—ì„œ íŠ¹ì • ì•Œë¦¼ì„ êµ¬ë…í•˜ëŠ” ê²ƒê³¼ ë¹„ìŠ·í•©ë‹ˆë‹¤.

íŠ¹ì • ì´ë²¤íŠ¸ì— ëŒ€í•œ ê´€ì‹¬ì„ í‘œì‹œí•œë‹¤ìŒ ìƒˆ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ ë¹„ë™ê¸°ì‹ìœ¼ë¡œ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ì œë¡œ ë°©ë²•ì´ ìœ ì‚¬í•˜ë¯€ë¡œ, Notification Centerì— ì•Œë¦¼ì„ ê²Œì‹œí•  ìˆ˜ ìˆëŠ” `publisher(for: object:)` Publisher typeë©”ì„œë“œê°€ ì œê³µë˜ì–´ìˆìŠµë‹ˆë‹¤.

``` swift

example(of: "Publisher") {
    // 1
    let myNotification = Notification.Name("MyNotification")
    // 2
    let publisher = NotificationCenter.default
        .publisher(for: myNotification, object: nil)
    
}
```

Notification Centerê°€ publisherì—†ì´ ì•Œë¦¼ì„ broadcastí•  ìˆ˜ ìˆì§€ë§Œ, ì´ëŸ¬í•œ ë©”ì„œë“œëŠ” ì˜¤ë˜ëœ ë¹„ë™ê¸° APIì—ì„œ ìƒˆë¡œìš´ ëŒ€ì²´ APIë¡œ ëŒ€ì²´í•˜ëŠ” ë¸Œë¦¿ì§€ ì—­í• ì˜ ë©”ì„œë“œë¼ê³  ìƒê° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</br>

publisherì€ 2ê°€ì§€ ì¢…ë¥˜ì˜ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.

1. ê°’
2. ì™„ë£Œ ì´ë²¤íŠ¸

publisherì€ 0ê°œ ì´ìƒì˜ ê°’ì„ ë°©ì¶œí•  ìˆ˜ ìˆì§€ë§Œ ì™„ë£Œ ì´ë²¤íŠ¸ëŠ” í•˜ë‚˜ë§Œ ë°©ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì™„ë£Œ ì´ë²¤íŠ¸ëŠ” ì¼ë°˜ì ì¸ ì •ìƒì ì¸ ì™„ë£Œ ì´ë²¤íŠ¸ ë˜ëŠ” ì˜¤ë¥˜ ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</br>

## Hello Subscriber

Subscriberì€ publisherë¡œë¶€í„° ì…ë ¥ ë°›ì„ ìˆ˜ ìˆëŠ” ìœ í˜•ì— ëŒ€í•œ ìš”êµ¬ì‚¬í•­ì„ ì •ì˜í•˜ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤.

``` swift
example(of: "Publisher") {
    // 1
    let myNotification = Notification.Name("MyNotification")
    // 2
    let publisher = NotificationCenter.default
        .publisher(for: myNotification, object: nil)
    
}
```

ìœ„ì—ì„œ ì‘ì„±í•œ ì˜ˆì œëŠ” êµ¬ë…ì´ ì—†ê¸°ë•Œë¬¸ì— publisherê°€ ì•Œë¦¼ì„ ì „ì†¡í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

</br>

## Subscribing with sink()

ì´ì „ ì˜ˆì œì— ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

``` swift
// 1
let subscription = publisher
  .sink { _ in
    print("Notification received from a publisher!")
  }
// 2
center.post(name: myNotification, object: nil)
// 3
subscription.cancel()
```

1. publisherì— sinkë¥¼ í˜¸ì¶œí•´ì„œ êµ¬ë…ì„ ìƒì„±í•©ë‹ˆë‹¤.
2. notificationì„ post
3. êµ¬ë… ì·¨ì†Œ

</br>

sinkë¥¼ í´ë¦­í•˜ë©´ publisherì˜ ì¶œë ¥ì„ ì²˜ë¦¬í•˜ê¸°ìœ„í•´ closureì™€ í•¨ê»˜ êµ¬ë…ìë¥¼ ì‰½ê²Œ ì—°ê²°í•  ìˆ˜ ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

sinkì—°ì‚°ìëŠ” publisherê°€ ë°©ì¶œí•˜ëŠ”ë§Œí¼ ë§ì€ ê°’ì„ ê³„ì† ë°›ì„ ê²ƒ ì…ë‹ˆë‹¤.

ì œí•œì´ ì—†ëŠ” ìš”ì²­ì…ë‹ˆë‹¤.

ì´ì „ ì˜ˆì‹œì—ì„œëŠ” ë¬´ì‹œí•˜ê³ í–ˆì§€ë§Œ, sinkì—°ì‚°ìëŠ” ì‹¤ì œë¡œëŠ” ì™„ë£Œ ì´ë²¤íŠ¸(ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨)ë¥¼ ìˆ˜ì‹ ì²˜ë¦¬í•˜ëŠ” ê²ƒê³¼ ìˆ˜ì‹  ê°’ì„ ì²˜ë¦¬í•˜ëŠ” 2ê°œì˜ í´ë¡œì €ë¥¼ ì œê³µí•©ë‹ˆë‹¤.



``` swift

example(of: "Just") {
    // 1
    let just = Just("Hello world!")
    // 2
    _ = just
        .sink(
            receiveCompletion: {
                print("Received completion", $0)
            },
            receiveValue: {
                print("Received value", $0)
            })
}

// print
 â€”â€”â€” Example of: Just â€”â€”â€”
Received value Hello world!
Received completion finished
```

1. ë‹¨ì¼ ê°’ publisherë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” `Just` ë¥¼ ì´ìš©í•´ì„œ publisherìƒì„±
2. publisherì— ëŒ€í•œ êµ¬ë…ìë¥¼ ìƒì„±í•˜ê³  ìˆ˜ì‹ ëœ ì´ë²¤íŠ¸ì— ëŒ€í•œ ë©”ì‹œì§€ë¥¼ printí•©ë‹ˆë‹¤.

</br>

Justì— ëŒ€í•œ ì„¤ëª…ì„ ë³´ë©´ **êµ¬ë…ìì—ê²Œ ì¶œë ¥ì„ í•œ ë²ˆ ë‚´ë³´ë‚¸ ë‹¤ìŒ ì™„ë£Œí•˜ëŠ” ê²Œì‹œì**ë¼ê³  ì„¤ëª…í•©ë‹ˆë‹¤.

ì½”ë“œëì— ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´

``` swift
_ = just
    .sink(
        receiveCompletion: {
            print("Received completion (another)", $0)
        },
        receiveValue: {
            print("Received value (another)", $0)
        })

// print
â€”â€”â€” Example of: Just â€”â€”â€”
Received value Hello world!
Received completion finished
Received value (another) Hello world!
Received completion (another) finished
```

</br>

## Subscribing with assign()

`sink`ë§ê³ ë„, `assign(to: on:)`ì—°ì‚°ìë¥¼ ì‚¬ìš©í•˜ë©´ ìˆ˜ì‹ ëœ ê°’ì„ ê°ì²´ì˜ KVOì†ì„±ì— í• ë‹¹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift

example(of: "assign(to:on:)") {
    class SomeObject {
        var value: String = "" {
            didSet {
                print(value)
            }
        } }
    let object = SomeObject()
    let publisher = ["Hello", "world!"].publisher
    // 1
    _ = publisher
        .assign(to: \.value, on: object)
}

// print
 â€”â€”â€” Example of: assign(to:on:) â€”â€”â€”
Hello
world!
```

1. ë°›ì€ ê°’ì„ ê°ì²´ì˜ `value`ë³€ìˆ˜ì— í• ë‹¹í•˜ë„ë¡ publisherë¥¼ êµ¬ë…í•©ë‹ˆë‹¤.

ë’¤ì—ìˆëŠ” ì±•í„°ì—ì„œ ì„¤ëª…í• ê±°ì§€ë§Œ assignì€ UIêµ¬ì„± ìš”ì†Œì— ì§ì ‘ ê°’ì„ í• ë‹¹í•  ìˆ˜ ìˆê¸°ë•Œë¬¸ì— UIKit, AppKitì•±ì—ì„œ ì‘ì—…í•  ë•Œ íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤.

</br>

## Republishing with assign()

`@Published` í”„ë¡œí¼í‹° ë ˆí¼ë¡œ í‘œì‹œëœ ë‹¤ë¥¸ í”„ë¡œí¼í‹°ë¥¼ í†µí•´ publisherê°€ ë°©ì¶œí•œ ê°’ì„ ë‹¤ì‹œ ê²Œì‹œí•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift

example(of: "assign(to:)") {
    // 1
    class SomeObject {
        @Published var value = 0
    }
    let object = SomeObject()
    // 2
    object.$value
        .sink {
            print($0)
        }
    // 3
    (0..<10).publisher
        .assign(to: &object.$value)
}
```

1. **@Published í”„ë¡œí¼í‹° ë ˆí¼ë¡œ ì •ì˜í•˜ê³  ìƒì„±í•˜ë©´, ì¼ë°˜ ì†ì„±ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ ê°’ì—ëŒ€í•œ publisherê°€ ìƒì„±ë©ë‹ˆë‹¤**.
2. $ì ‘ë‘ì‚¬ë¥¼ ì´ìš©í•˜ì—¬ publisherì— ì ‘ê·¼í•  ìˆ˜ ìˆê³ , êµ¬ë…í•˜ê³  ê°’ì„ printí•©ë‹ˆë‹¤.
3. ìˆ«ì publisherë¥¼ ë§Œë“¤ê³  ë°©ì¶œí•˜ëŠ” ê° ê°’ì„ objectì˜ value publisherì— assigní•©ë‹ˆë‹¤.
   í”„ë¡œí¼í‹°ì— ëŒ€í•´ inoutì°¸ì¡°ë¥¼ ë‚˜íƒ€ë‚´ê¸°ìœ„í•´ &ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

**`assign(to:)`ì—°ì‚°ìëŠ” AnyCancellable í† í°ì„ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ğŸ“Œ**@Published í”„ë¡œí¼í‹°ê°€ í•´ì œë ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ ë¼ì´í”„ì‚¬ì´í´ì„ ê´€ë¦¬í•˜ê³  êµ¬ë…ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.**

</br>

### assign(to: on:)ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ì´ê²ƒì´ ì–´ë–»ê²Œ ë‹¤ë¥¸ê°€?

``` swift
class MyObject {
    @Published var word: String = ""
    var subscriptions = Set<AnyCancellable>()
    
    init() {
        ["A", "B", "C"].publisher
            .assign(to: \.word, on: self)
            .store(in: &subscriptions)
    }
    
    deinit {
        print("deinit")
    }
}
```

ìœ„ì˜ ì˜ˆì œì—ì„œ `.assign(to: \.word, on: self)`ê²°ê³¼ AnyCancellableë¥¼ ê°•í•œì°¸ì¡°ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

`assign(to: &word)` ë¡œ ìˆ˜ì •í•˜ ì´ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ê°œì¸ìƒê°

assign(to: )ë°©ì‹ê³¼ assign(to: on:)ë°©ì‹ì˜ ì •í™•í•œ ì°¨ì´ë¥¼ ì˜ ëª¨ë¥´ê² ìŒ

ê²°êµ­ @Published í”„ë¡œí¼í‹°ë„ ê°•í•œì°¸ì¡°ë¡œ ê°’ì„ ì €ì¥í•˜ê³ , í•´ì œë ë•Œ ë‚´ë¶€ì ìœ¼ë¡œ êµ¬ë…ì„ ì·¨ì†Œí•¨.

storeë¥¼ ì´ìš©í•œ AnyCancellableì„ ì €ì¥í•˜ëŠ” ë°©ì‹ë„ í•´ì œë ë•Œ êµ¬ë…ì„ ì·¨ì†Œí•˜ëŠ” ë°©ì‹ì„.

í…ŒìŠ¤íŠ¸í•œê²°ê³¼ ì˜ˆìƒëŒ€ë¡œ ê°•í•œì°¸ì¡°ë•Œë¬¸ì— deinitì´ ì•ˆë˜ëŠ” í˜„ìƒì€ ì—†ìŒ

</br>

## Hello Cancellable

êµ¬ë…ìê°€ ì‘ì—…ì„ ëë‚´ê³  publisherë¡œë¶€í„° ê°’ì„ ë” ì´ìƒ ë°›ê¸°ë¥¼ ì›ì¹˜ì•Šìœ¼ë©´ ìì›ì„ í™•ë³´í•˜ê³  ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œê³¼ ê°™ì€ ì•¡ì…˜ì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ êµ¬ë…ì„ ì·¨ì†Œí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

êµ¬ë…ì€ êµ¬ë…ì„ ì·¨ì†Œí•  ìˆ˜ ìˆëŠ” "cancellation token"ì¸ AnyCancellable ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

AnyCancellableì€ Cancellable í”„ë¡œí† ì½œì„ ë”°ë¥´ë©°, `cancel()` ë©”ì„œë“œë¥¼ í•„ìš”ë¡œí•©ë‹ˆë‹¤.

</br>

``` swift
@available(macOS 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *)
public protocol Subscription : Cancellable, CustomCombineIdentifierConvertible {

    /// Tells a publisher that it may send more values to the subscriber.
    func request(_ demand: Subscribers.Demand)
}
```

Subscriptioní”„ë¡œí† ì½œì€ Cancellableì„ ë”°ë¥´ê¸° ë•Œë¬¸ì— êµ¬ë…ì‹œ cancel()ë¥¼ í˜¸ì¶œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

cancel()ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ **ê²Œì‹œìê°€ ì™„ë£Œë  ë•Œ ê¹Œì§€** ë˜ëŠ” ë©”ëª¨ë¦¬ ê´€ë¦¬ë¡œ ì¸í•´ **ì €ì¥ëœ êµ¬ë…ì´ í•´ì œë  ë•Œ ê¹Œì§€** ê³„ì†ë©ë‹ˆë‹¤.

</br>

## Understanding whatâ€™s going on

publisherê³¼ subscriberì‚¬ì´ì˜ ìƒí˜¸ì‘ìš©ì„ ì„¤ëª…í•˜ëŠ” ì‚¬ì§„ì…ë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/35462671/166234233-4cff111f-ff7e-4ea2-8863-cd5cc9103653.png)

1. êµ¬ë…ìê°€ publisherë¥¼ êµ¬ë…í•©ë‹ˆë‹¤.
2. publisherì€ êµ¬ë…ì„ ìƒì„±í•˜ì—¬ êµ¬ë…ìì—ê²Œ ì œê³µí•©ë‹ˆë‹¤.
3. êµ¬ë…ìê°€ ê°’ì„ ìš”ì²­í•©ë‹ˆë‹¤.
4. publisherê°€ ê°’ì„ ë³´ëƒ…ë‹ˆë‹¤.
5. publisherê°€ ì™„ë£Œë¥¼ ë³´ëƒ…ë‹ˆë‹¤.

</br>

ë‹¤ìŒì€ Publisher í”„ë¡œí† ì½œê³¼ ê°€ì¥ì¤‘ìš”í•œ extensionì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

``` swift 
public protocol Publisher {
    // 1
    associatedtype Output
    // 2
    associatedtype Failure : Error
    // 4
    func receive<S>(subscriber: S)
    where S: Subscriber,
          Self.Failure == S.Failure,
          Self.Output == S.Input
}
extension Publisher {
    // 3
    public func subscribe<S>(_ subscriber: S)
    where S : Subscriber,
          Self.Failure == S.Failure,
          Self.Output == S.Input
}
```

1. publisherê°€ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê°’ì˜ íƒ€ì…ì…ë‹ˆë‹¤.
2. publisherê°€ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì˜¤ë¥˜ íƒ€ì…, ì˜¤ë¥˜ë¥¼ ìƒì„±í•˜ì§€ ì•Šë„ë¡ ë³´ì¥ëœ ê²½ìš° `Never`ì…ë‹ˆë‹¤.
3. êµ¬ë…ìëŠ” subscribe(_ :)ì„ í˜¸ì¶œí•˜ì—¬ publisherë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
4. subscribe(_ :)ì˜ êµ¬í˜„ì€ subscriberë¥¼ publisherì— ì—°ê²°í•˜ê¸°ìœ„í•´ receive(subscriber:)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. ì¦‰, êµ¬ë…ì„ ìƒì„±í•©ë‹ˆë‹¤.

ì—°ê´€ëœ íƒ€ì…ì€ êµ¬ë…ì„ ìƒì„±í•˜ê¸°ìœ„í•´ subscriberê°€ ì¼ì¹˜í•´ì•¼í•˜ëŠ” publisherì˜ ì¸í„°í˜ì´ìŠ¤ ì…ë‹ˆë‹¤.

ë‹¤ìŒì€ Subscriber í”„ë¡œí† ì½œì…ë‹ˆë‹¤.

``` swift
public protocol Subscriber: CustomCombineIdentifierConvertible {
  // 1
  associatedtype Input
  // 2
  associatedtype Failure: Error
  // 3
  func receive(subscription: Subscription)
  // 4
  func receive(_ input: Self.Input) -> Subscribers.Demand
  // 5
  func receive(completion: Subscribers.Completion<Self.Failure>)
}
```

1. êµ¬ë…ìê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ê°’ì˜ íƒ€ì…ì…ë‹ˆë‹¤.
2. êµ¬ë…ìê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ì˜¤ë¥˜ íƒ€ì…ì…ë‹ˆë‹¤. Neverì´ë©´ ì—ëŸ¬ë¥¼ ë°›ì§€ì•ŠìŠµë‹ˆë‹¤.
3. publisherëŠ” êµ¬ë…ìì˜ `receive(subscription: )`ë¥¼ í˜¸ì¶œí•˜ì—¬ êµ¬ë…ì„ ì œê³µí•©ë‹ˆë‹¤.
4. publisherëŠ” êµ¬ë…ìì˜ `receive(_ :)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ë°©ê¸ˆ ê²Œì‹œí•œ ìƒˆ ê°’ì„ ë³´ëƒ…ë‹ˆë‹¤.
5. publisherëŠ” êµ¬ë…ìì˜ `receive(completion: )`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì •ìƒì ìœ¼ë¡œ ë˜ëŠ” ì˜¤ë¥˜ë¡œ ì¸í•´ ê°’ ìƒì„±ì„ ì™„ë£Œí–ˆìŒì„ ì•Œë¦½ë‹ˆë‹¤.

publisherì™€ subscriberê°„ì˜ ì—°ê²°ì€ subscription(êµ¬ë…)ì…ë‹ˆë‹¤.

Subscriptioní”„ë¡œí† ì½œì€ ì•„ë˜ì™€ê°™ìŠµë‹ˆë‹¤.

``` swift
public protocol Subscription: Cancellable,
CustomCombineIdentifierConvertible {
  func request(_ demand: Subscribers.Demand)
}
```

subscriberì€ `request(_ :)`ë¥¼ í˜¸ì¶œí•˜ì—¬ ìµœëŒ€ ê°’ ë˜ëŠ” ë¬´ì œí•œê¹Œì§€ ë” ë§ì€ ê°’ì„ ë°›ì„ ì˜ì‚¬ê°€ ìˆìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

Subscriberì—ì„œ `receive(_ :)`ëŠ” Demandë¥¼ ë°˜í™˜í•¨ì„ ì•Œë¦½ë‹ˆë‹¤.

`subscription.request(_ :)`ëŠ” êµ¬ë…ìê°€ ë°›ê³ ìí•˜ëŠ” ê°’ì˜ ìµœëŒ“ê°’ì„ ì„¤ì •í•˜ì§€ë§Œ, ìƒˆë¡œìš´ ê°’ì´ ìˆ˜ì‹ ë  ë•Œë§ˆë‹¤ ê·¸ ìµœëŒ“ê°’ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Subscriber.receive(_ :)ì—ì„œ maxë¥¼ ì¡°ì •í•˜ëŠ” ê²ƒì€ ì¶”ê°€ì ì¸ ê²ƒì…ë‹ˆë‹¤.

ì¦‰, ìƒˆë¡œìš´ maxê°’ì´ í˜„ì¬ maxì— ì¶”ê°€ë©ë‹ˆë‹¤.

ìµœëŒ“ê°’ì€ ì–‘ìˆ˜ì—¬ì•¼í•˜ë©° ìŒìˆ˜ê°’ì„ ì „ë‹¬í•˜ë©´ fatal errorê°€ ë°œìƒí•©ë‹ˆë‹¤.

ì¦‰, ìƒˆ ê°’ì„ ë°›ì„ ë•Œë§ˆë‹¤ ì›ë˜ì˜ ìµœëŒ“ê°’ì„ ëŠ˜ë¦´ ìˆ˜ëŠ” ìˆì§€ë§Œ ì¤„ì¼ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

</br>

## Creating a custom subscriber

``` swift
example(of: "Custom Subscriber") {
    // 1
    let publisher = (1...6).publisher
    // 2
    final class IntSubscriber: Subscriber {
        // 3
        typealias Input = Int
        typealias Failure = Never
        // 4 ê²Œì‹œìê°€ ë°›ì„ ìˆ˜ ìˆëŠ” ìµœëŒ€ ìˆ˜
        func receive(subscription: Subscription) {
            subscription.request(.max(3))
        }
        // 5 ê° ê°’ì„ ë°›ì„ë•Œ ìµœëŒ“ê°’ì„ ìˆ˜ì •í•¨(.max(1)ì´ë¼ë©´ 1ì”© ì¦ê°€í•¨)
        func receive(_ input: Int) -> Subscribers.Demand {
            print("Received value", input)
            return .none
        }
        // 6 
        func receive(completion: Subscribers.Completion<Never>) {
            print("Received completion", completion)
        }
    }
}
```

1. ì •ìˆ˜í˜• ê²Œì‹œìì¸ publisher ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
2. ì‚¬ìš©ì ì§€ì • êµ¬ë…ìì¸ IntSubscriberë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
3. ì´ êµ¬ë…ìê°€ ì •ìˆ˜ ì…ë ¥ì„ ë°›ì„ ìˆ˜ ìˆê³  ì˜¤ë¥˜ë¥¼ ë°›ì§€ì•Šë„ë¡ ì§€ì •í•©ë‹ˆë‹¤.
4. publisherê°€ í˜¸ì¶œí•˜ëŠ” `receive(subscription:)`ë¶€í„° ìš”êµ¬ ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ì„¸ìš”. ì´ ë©”ì„œë“œì—ì„œëŠ” êµ¬ë…ì‹œ ìµœëŒ€ 3ê°œì˜ ê°’ì„ ë°›ì„ ê²ƒì„ ì§€ì •í•˜ëŠ” `.request(_:)`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
5. ê° ê°’ì„ ìˆ˜ì‹ í•œëŒ€ë¡œ ì¶œë ¥í•˜ê³  .noneì„ ë°˜í™˜í•˜ë©´ êµ¬ë…ìê°€ ìš”êµ¬ì„ ì¡°ì •í•˜ì§€ ì•ŠìŒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. 
   .noneì€ .max(0)ê³¼ ë™ì¼í•©ë‹ˆë‹¤.
6. ì™„ë£Œì´ë²¤íŠ¸ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.

publisherê°€ ê²Œì‹œí•˜ê¸° ìœ„í•´ì„œëŠ” êµ¬ë…ìê°€ í•„ìš”í•©ë‹ˆë‹¤.

ì˜ˆì œì˜ ëì— ë°©ê¸ˆ ì •ì˜í•œ êµ¬ë…ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

publisherì˜ Outputê³¼ Failureíƒ€ì…ì— ì¼ì¹˜í•˜ëŠ” êµ¬ë…ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

ê·¸ ë‹¤ìŒ publisherì—ê²Œ êµ¬ë…ìë¥¼ êµ¬ë…í•˜ê±°ë‚˜ ì—°ê²°í•˜ë¼ê³  í•©ë‹ˆë‹¤.

```swift
let subscriber = IntSubscriber()
publisher.subscribe(subscriber)

// print
â€”â€”â€” Example of: Custom Subscriber â€”â€”â€”
Received value 1
Received value 2
Received value 3
```

ì™„ë£Œ ì´ë²¤íŠ¸ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

.max(3)ìœ¼ë¡œ ìš”êµ¬ë¥¼ ì§€ì •í•´ì„œ publisherê°€ í•œì •ëœ ìˆ˜ì˜ ê°’ì„ ê°€ì§€ê³ ìˆê¸° ë–„ë¬¸ì…ë‹ˆë‹¤.

ì‚¬ìš©ì ì§€ì • êµ¬ë…ìì—ì„œ `receive(_:)`ì—ì„œ .noneì„ .unlimitedìœ¼ë¡œ ë³€ê²½í•´ë³´ì„¸ìš”.

```swift
func receive(_ input: Int) -> Subscribers.Demand {
  print("Received value", input)
  return .unlimited
}
// print
â€”â€”â€” Example of: Custom Subscriber â€”â€”â€”
Received value 1
Received value 2
Received value 3
Received value 4
Received value 5
Received value 6
Received completion finished
```

.max(1)ë¡œ ë³€ê²½í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ë„ .unlimitedë¥¼ í–ˆì„ ë•Œì™€ ê°™ì€ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë§¤ë²ˆ ì´ë²¤íŠ¸ë¥¼ ë°›ìœ¼ë©´ ìµœëŒ“ê°’ì„ 1ë§Œí¼ ì˜¬ë¦¬ê³  ì‹¶ë‹¤ê³  ì§€ì •í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

.max(1)ë¥¼ ë‹¤ì‹œ .noneìœ¼ë¡œ ë³€ê²½í•˜ê³  publisherë°°ì—´ì„ stringìœ¼ë¡œ ì •ì˜í•´ë³´ì„¸ìš”.

publisherì˜ Outputê³¼ Failure associated typeì´ subscriberì˜ Inputê³¼ Failureíƒ€ì…ê³¼ ì¼ì¹˜í•´ì•¼ í•œë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

</br>

## Hello Future

`Just`ë¥¼ ì´ìš©í•´ì„œ êµ¬ë…ìì—ê²Œ ë‹¨ì¼ ê°’ì„ ë°©ì¶œí•œ ë’¤ ì™„ë£Œí•˜ëŠ” publisherë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì²˜ëŸ¼ `Future`ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë‹¨ì¼ ê²°ê³¼ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ìƒì„±í•œ ë‹¤ìŒ ì™„ë£Œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¥ê¸°ê°„ ë¹„ë™ê¸° ì‘ì—…ì˜ ê²½ìš° êµ¬ë…ì„ ì €ì¥í•˜ì§€ ì•Šìœ¼ë©´ í˜„ì¬ì½”ë“œscopeê°€ ëë‚˜ìë§ˆì êµ¬ë…ì´ ì·¨ì†Œë©ë‹ˆë‹¤.

``` swift 
func futureIncrement(
    integer: Int,
    afterDelay delay: TimeInterval) -> Future<Int, Never> {
        Future<Int, Never> { promise in
            DispatchQueue.global().asyncAfter(deadline: .now() + delay) {
                promise(.success(integer + 1))
            }
        }
    }
}
```

ì´ ì½”ë“œëŠ” ì§€ì •í•œ ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•˜ê³  ì§€ì—° í›„ ì •ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” promiseë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

Futureì€ ê²°êµ­ í•˜ë‚˜ì˜ ê°’ì„ ìƒì‚°í•˜ê³  ëë‚˜ê±°ë‚˜, ì‹¤íŒ¨í•  publisherì…ë‹ˆë‹¤.

ê°’ì´ë‚˜ ì˜¤ë¥˜ê°€ ìˆì„ ë•Œ closureë¥¼ í˜¸ì¶œí•˜ê³ , ì‹¤ì œë¡œ closureê°€ promiseì…ë‹ˆë‹¤.

ì •ì˜ì— ê°€ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift
final public class Future<Output, Failure> : Publisher
  where Failure: Error {
  public typealias Promise = (Result<Output, Failure>) -> Void
  ...
}
```

PromiseëŠ” ë‹¨ì¼ê°’ ë˜ëŠ” ì˜¤ë¥˜ê°€ í¬í•¨ëœ Resultë¥¼ ìˆ˜ì‹ í•˜ëŠ” closureíƒ€ì…ì…ë‹ˆë‹¤.

ë‹¤ìŒ ì½”ë“œë¥¼ í•¨ìˆ˜ì•„ë˜ì— ì¶”ê°€í•©ë‹ˆë‹¤.

``` swift
var subscriptions = Set<AnyCancellable>()
// 1
let future = futureIncrement(integer: 1, afterDelay: 3)
// 2
future
    .sink(receiveCompletion: { print($0) },
          receiveValue: { print($0) })
    .store(in: &subscriptions)
// print
 â€”â€”â€” Example of: Future â€”â€”â€”
2
finished
```

1. 3ì´ˆ ì§€ì—°í›„ ì „ë‹¬í•œ ì •ìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ë„ë¡ Futureìƒì„±
2. ìˆ˜ì‹ ëœ ê°’ê³¼ ì™„ë£Œëœ ì´ë²¤íŠ¸ë¥¼ êµ¬ë…í•˜ê³  ì¶œë ¥í•˜ê³ , êµ¬ë…ê²°ê³¼ë¥¼ êµ¬ë…setì— storeí•©ë‹ˆë‹¤.

</br>

ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ê³ 

``` swift
future
  .sink(receiveCompletion: { print("Second", $0) },
        receiveValue: { print("Second", $0) })
  .store(in: &subscriptions)
```

ê¸°ì¡´ì˜ futureIncrementí•¨ìˆ˜ì—ì„œ dispatchQueueë¸”ëŸ­ì•ì— ì¶œë ¥ë¬¸ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

``` swift
func futureIncrement(
    integer: Int,
    afterDelay delay: TimeInterval) -> Future<Int, Never> {
        Future<Int, Never> { promise in
            print("Original") // << ì¶”ê°€ëœë¶€ë¶„
            DispatchQueue.global().asyncAfter(deadline: .now() + delay) {
                promise(.success(integer + 1))
            }
        }
    }
}
```

``` swift
//print 
Original
2
finished
Second 2
Second finished
```

ğŸ“Œ**Futureì€ promiseë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì§€ì•ŠìŠµë‹ˆë‹¤**. ëŒ€ì‹  ê·¸ **ê²°ê³¼ë¥¼ ê³µìœ í•˜ê±°ë‚˜ replay(ì¬ì‚¬ìš©ì„ ì˜ë¯¸í•˜ëŠ”ê²ƒ ê°™ìŒ)í•©ë‹ˆë‹¤.**

</br>

## Hello Subject

non-Combine ëª…ë ¹í˜•ì½”ë“œê°€ Combine êµ¬ë…ìì—ê²Œ ê°’ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë§¤ê°œì²´ ì—­í• ì„ í•©ë‹ˆë‹¤.

``` swift

example(of: "PassthroughSubject") {
    enum MyError: Error {
        case test 
    }
    
    final class StringSubscriber: Subscriber {
        typealias Input = String
        typealias Failure = MyError
        func receive(subscription: Subscription) {
            subscription.request(.max(2))
        }
        func receive(_ input: String) -> Subscribers.Demand {
            print("Received value", input)
    
            return input == "World" ? .max(1) : .none
        }
        func receive(completion: Subscribers.Completion<MyError>) {
            print("Received completion", completion)
        }
    }
    
    let subscriber = StringSubscriber()
    
    let subject = PassthroughSubject<String, MyError>()
    
    subject.subscribe(subscriber)
    
    let subscription = subject
        .sink(
            receiveCompletion: { completion in
                print("Received completion (sink)", completion)
            },
            receiveValue: { value in
                print("Received value (sink)", value)
            }
        )
    
    subject.send("Hello")
    subject.send("World")
}
// print
-â€”â€” Example of: PassthroughSubject â€”â€”â€”
Received value Hello
Received value (sink) Hello
Received value World
Received value (sink) World
```

PassthroughSubjectëŠ” ìš”êµ¬ì— ë”°ë¼ ìƒˆ ê°’ì„ ê²Œì‹œí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. 

ê°’ê³¼ ì™„ë£Œ ì´ë²¤íŠ¸ë¥¼ ê°€ì§€ê³  ì˜ ì „ë‹¬í•  ê²ƒì…ë‹ˆë‹¤.

ëª¨ë“  publisherì™€ ë§ˆì°¬ê°€ì§€ë¡œ, ì‚¬ì „ì— ë°©ì¶œí•  ìˆ˜ ìˆëŠ” ê°’ ë° ì˜¤ë¥˜íƒ€ì…ì„ ì„ ì–¸í•´ì•¼í•©ë‹ˆë‹¤.

êµ¬ë…ìëŠ” passthrough subjectë¥¼ êµ¬ë…í•˜ë ¤ë©´ input, failureíƒ€ì…ì„ ì¼ì¹˜ ì‹œì¼œì•¼í•©ë‹ˆë‹¤. 

</br>

ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´

``` swift
subscription.cancel()
subject.send("Still there?")
// print
â€”â€”â€” Example of: PassthroughSubject â€”â€”â€”
Received value Hello
Received value (sink) Hello
Received value World
Received value (sink) World
Received value Still there?
```

ë‘ë²ˆì§¸ êµ¬ë…ìì˜ êµ¬ë…ì„ ì·¨ì†Œí–ˆê¸°ë•Œë¬¸ì— ì²«ë²ˆì§¸ êµ¬ë…ìë§Œ ê°’ì„ ë°›ìŠµë‹ˆë‹¤.

</br>

ì•„ë˜ì˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´

``` swift
subject.send(completion: .finished)
subject.send("How about another one?")
// print
â€”â€”â€” Example of: PassthroughSubject â€”â€”â€”
Received value Hello
Received value (sink) Hello
Received value World
Received value (sink) World
Received value Still there?
Received completion finished
```

subjectë¡œ ê°’ì„ ë³´ë‚´ê¸°ì „ì— ì™„ë£Œì´ë²¤íŠ¸ë¥¼ ë°›ì•˜ê¸° ë•Œë¬¸ì— ë‘ë²ˆì§¸ êµ¬ë…ìëŠ” "How about another one"ê°’ì„ ë°›ì§€ëª»í•©ë‹ˆë‹¤.

ì²«ë²ˆì§¸ êµ¬ë…ìëŠ” ì´ì „ì— êµ¬ë…ì´ ì·¨ì†Œë˜ì—ˆê¸° ë•Œë¬¸ì— ì™„ë£Œì´ë²¤íŠ¸ë‚˜ ê°’ì„ ë°›ì§€ ëª»í•©ë‹ˆë‹¤.

ì™„ë£Œì´ë²¤íŠ¸ ì§ì „ì— ì•„ë˜ì˜ ì½”ë“œë¥¼ ì‚½ì…í•˜ë©´

``` swift
subject.send(completion: .failure(MyError.test))
// print
â€”â€”â€” Example of: PassthroughSubject â€”â€”â€”
Received value Hello
Received value (sink) Hello
Received value World
Received value (sink) World
Received value Still there?
Received completion failure(...MyError.test)
```

ì²«ë²ˆì§¸ êµ¬ë…ìëŠ” ì˜¤ë¥˜ë¥¼ ë°›ì§€ë§Œ ì˜¤ë¥˜ ì´í›„ì— ì „ì†¡ì™„ë£Œëœ ì´ë²¤íŠ¸ëŠ” ë°›ì§€ì•ŠìŠµë‹ˆë‹¤.

ì´ê²ƒì€ publisherê°€ ë‹¨ì¼ ì™„ë£Œì´ë²¤íŠ¸(ì •ìƒì ì¸ ì™„ë£Œ, ë˜ëŠ” ì˜¤ë¥˜ì¸ì§€ ì—¬ë¶€)ë¥¼ ë³´ë‚´ë©´ ê·¸ê²ƒì€ ëì…ë‹ˆë‹¤. ë!

PassthroughSubjectë¡œ ê°’ì„ ì „ë‹¬í•˜ëŠ” ê²ƒì€ ëª…ë ¹í˜• ì½”ë“œë¥¼ combineì˜ ì„ ì–¸ì  ì„¸ê³„ì— ì—°ê²°í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ë•Œë–„ë¡œ, ëª…ë ¹í˜• ì½”ë“œì—ì„œ publisherì˜ í˜„ì¬ ê°’ì„ ë³´ê³ ì‹¶ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ê·¸ê²ƒì„ ìœ„í•œ ê²ƒì´ CurrentValueSubjectì…ë‹ˆë‹¤.

ê° êµ¬ë…ì„ ê°’ìœ¼ë¡œ ì €ì¥í•˜ëŠ” ëŒ€ì‹  AnyCancellableì»¬ë™ì…˜ì— ì—¬ëŸ¬êµ¬ë…ì„ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ° ë‹¤ìŒ ì»¬ë™ì…˜ì´ í•´ì œë˜ê¸° ì§ì „ì— ì»¬ë™ì…˜ì— ì¶”ê°€ëœ ê° êµ¬ë…ì„ ìë™ìœ¼ë¡œ ì·¨ì†Œí•©ë‹ˆë‹¤.

</br>

current value subjectëŠ” ì´ˆê¸°í™” ê°’ì´ í•„ìš”í•©ë‹ˆë‹¤.

ìƒˆë¡œìš´ êµ¬ë…ìëŠ” ì¦‰ì‹œ í•´ë‹¹ ê°’ ë˜ëŠ” subjectì˜ ìµœê·¼ì— ê²Œì‹œí•œ ê°’ì„ ì–»ìŠµë‹ˆë‹¤.

``` swift
example(of: "CurrentValueSubject") {
  var subscriptions = Set<AnyCancellable>()
  let subject = CurrentValueSubject<Int, Never>(0)
  subject
    .sink(receiveValue: { print($0) })
    .store(in: &subscriptions)
}
â€”â€”â€” Example of: CurrentValueSubject â€”â€”â€”
0
```



```swift
subject.send(1)
subject.send(2)
// print
1
2
```

passthrought subjectì™€ ë‹¬ë¦¬ current value subjectëŠ” ì–¸ì œë“ ì§€ í˜„ì¬ê°’ì„ ìš”ì²­í•  ìˆ˜ìˆìŠµë‹ˆë‹¤.

subjectì˜ í˜„ì¬ê°’ì„ ì¶œë ¥í•˜ë ¤ë©´ ë‹¤ìŒì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”

``` swift
print(subject.value)
```

í•´ë‹¹ valueí”„ë¡œí¼í‹°ì— ì ‘ê·¼í•˜ì—¬ í˜„ì¬ ê°’ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

current value subjectì— send(_:)ë¥¼ í™”ì¶œí•˜ëŠ” ê²ƒì€ ìƒˆ ê°’ì„ ë³´ë‚´ëŠ” í•œê°€ì§€ ë°©ë²•ì…ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ valueí”„ë¡œí¼í‹°ì—ì„œ ìƒˆë¡œìš´ ê°’ì„ í• ë‹¹í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

``` swift
subject.value = 3
print(subject.value)
```

</br>

êµ¬ë…setì—ì„œ ìë™ìœ¼ë¡œ êµ¬ë…ì— ì¶”ê°€ëœ êµ¬ë…ì„ ì·¨ì†Œí•œë‹¤ëŠ” ê²ƒì„ ì•Œì§€ë§Œ, ì–´ë–»ê²Œ í™•ì¸í•  ê²ƒì¸ê°€ìš”?

**ëª¨ë“  publishing ì´ë²¤íŠ¸ë¥¼ ì½˜ì†”ì— ê¸°ë¡í•´ì£¼ëŠ” `print()`ì—°ì‚°ìë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

</br>

```swift
subject.value = .finished
```

ìœ„ì˜ì½”ë“œì™€ ê°™ì´ valueí”„ë¡œí¼í‹°ì— ì™„ë£Œì´ë²¤íŠ¸ë¥¼ í• ë‹¹í•  ìˆ˜ ìˆì„ê¹Œìš”?

ì•ˆë©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

CurrentValueSubjectì˜ valueí”„ë¡œí¼í‹°ëŠ” ê°’ì— ëŒ€í•œê²ƒì…ë‹ˆë‹¤. 

send(_:)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì™„ë£Œì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ì•¼í•©ë‹ˆë‹¤.

</br>

## Dynamically adjusting demand

``` swift
example(of: "Dynamically adjusting Demand") {
    final class IntSubscriber: Subscriber {
        typealias Input = Int
        typealias Failure = Never
        func receive(subscription: Subscription) {
            subscription.request(.max(2))
        }
        func receive(_ input: Int) -> Subscribers.Demand {
            print("Received value", input)
            switch input {
            case 1:
                return .max(2) // 1
            case 3:
                return .max(1) // 2
            default:
                return .none
            }
        }
        func receive(completion: Subscribers.Completion<Never>) {
            print("Received completion", completion)
        }
    }
    let subscriber = IntSubscriber()
    let subject = PassthroughSubject<Int, Never>()
    subject.subscribe(subscriber)
    subject.send(1)
    subject.send(2)
    subject.send(3)
    subject.send(4)
    subject.send(5)
    subject.send(6)
}
// print
â€”â€”â€” Example of: Dynamically adjusting Demand â€”â€”â€”
Received value 1
Received value 2
Received value 3
Received value 4
Received value 5
```

1. ì…ë ¥ë°›ì€ ê°’ì´ 1ì¼ë•Œ original max 2 + new max 2 = max 4ê°€ ë©ë‹ˆë‹¤.
2. ì…ë ¥ë°›ì€ ê°’ì´ 3ì¼ë•Œ ì´ì „ max 4 + new max 1 = max 5ê°€ ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ 5ê°œì˜ ì¶œë ¥ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

</br>

## Type erasure

êµ¬ë…ìê°€ publisherì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì„¸ë¶€ì •ë³´ì— ì ‘ê·¼í•˜ì§€ ì•Šê³  publisherë¡œ ë¶€í„° ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ë„ë¡ êµ¬ë…í•˜ë ¤ëŠ” ê²½ìš°ê°€ìˆìŠµë‹ˆë‹¤.

``` swift

example(of: "Type erasure") {
    var subscriptions = Set<AnyCancellable>()
    let subject = PassthroughSubject<Int, Never>()
    let publisher = subject.eraseToAnyPublisher()
    
    publisher
        .sink(receiveValue: { print($0) })
        .store(in: &subscriptions)
    subject.send(0)
}
```

ìƒìˆ˜ publisherì˜ íƒ€ì…ì€ AnyPublisher<Int, Never>ì…ë‹ˆë‹¤.

AnyPublisherì€ Publisherí”„ë¡œí† ì½œì„ ì¤€ìˆ˜í•˜ëŠ” type-erased êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.

íƒ€ì…ì„ ì‚­ì œí•˜ë©´ êµ¬ë…ì ë˜ëŠ” ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ publisherì—ê²Œ publisherì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•ì—ì„œ ë³¸ AnyCancellableë„ ë˜í•œ Cancellableì„ ë”°ë¥´ëŠ” type-erased í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ type-erasureì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œì¤‘ í•˜ë‚˜ëŠ” publicê³¼ private í”„ë¡œí¼í‹°ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
í”„ë¡œí¼í‹°ê°€ ì†í•œ ë‚´ë¶€ì—ì„œ private publisherì—ê²Œ ê°’ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ê³ , ì™¸ë¶€ì—ì„œ ê°’ì„ ì ‘ê·¼í•  ìˆ˜ ì—†ê³  public publisherë¥¼ êµ¬ë…í•´ì„œ ì ‘ê·¼ë§Œ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.

AnyPublisherì—ëŠ” send(_:)ì—°ì‚°ìê°€ ì—†ìœ¼ë¯€ë¡œ í•´ë‹¹ ê²Œì‹œìì— ìƒˆê°’ì„ ì§ì ‘ ê°’ì„ ì¶”ê°€í• ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

`eraseToAnyPublisher()`ì—°ì‚°ìëŠ” ì œê³µëœ publisherë¥¼ AnyPublisherì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë˜í•‘í•˜ì—¬ publisherê°€ ì‹¤ì œë¡œëŠ” PassthroughSubjectë¼ëŠ” ê²ƒì„ ìˆ¨ê¹ë‹ˆë‹¤.

</br>

## Bridging Combine publishers to async/await

subject ë˜ëŠ” publisherì— `values`ëŠ” ë°©ì¶œí•˜ëŠ” ìš”ì†Œì™€ asynchronous sequenceë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

ê°„ë‹¨í•œ for loopì—ì„œ ë¹„ë™ê¸° ì‹œí€€ìŠ¤ë¥¼ ë°˜ë³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` swift
var subscriptions = Set<AnyCancellable>()
let subject = CurrentValueSubject<Int, Never>(0)
var element = 0

Task {
    for await element in subject.values {
        print("Element: \(element)")
    }
    print("Completed.")
}

print("hi")

Timer.publish(every: 2, on: RunLoop.main, in: .default)
    .autoconnect()
    .sink { [self] _ in
        subject.send(element)
        element += 2
        if element == 6 {
            subject.send(completion: .finished)
            subscriptions.removeAll()
        }
    }
    .store(in: &subscriptions)
// print
hi
Element: 0
Element: 0
Element: 2
Element: 4
Completed.

```

